<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ESP32 Live GPS Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <style>
    #map { 
      height: 100vh; 
      width: 100%; 
    }
  </style>

  <!-- Leaflet Maps CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>

<body>

  <div id="map"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- Leaflet Maps JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBEgb15uKQSfReeafXrPi12uRvnIWFIZJE",
      authDomain: "esp32-tracker-8d016.firebaseapp.com",
      databaseURL: "https://esp32-tracker-8d016-default-rtdb.firebaseio.com",
      projectId: "esp32-tracker-8d016",
      storageBucket: "esp32-tracker-8d016.appspot.com",
      messagingSenderId: "704973480507",
      appId: "1:704973480507:web:f87ca76819432cabe7f21e",
      measurementId: "G-36FG8CD62W"
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();

    // Initialize map
    var map = L.map('map').setView([0, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data Â© OpenStreetMap contributors'
    }).addTo(map);

    var marker = L.marker([0, 0]).addTo(map);

    // Store path points
    var pathCoordinates = [];
    var polyline = L.polyline(pathCoordinates, { color: 'blue' }).addTo(map);

    // Function to update location
    function updateLocation() {
      database.ref('/location').once('value').then((snapshot) => {
        var data = snapshot.val();
        if (data) {
          var lat = data.latitude;
          var lng = data.longitude;

          // Update marker position
          marker.setLatLng([lat, lng]);
          map.setView([lat, lng], 18);

          // Add new point to path
          pathCoordinates.push([lat, lng]);
          polyline.setLatLngs(pathCoordinates);
        }
      }).catch((error) => {
        console.error("Error fetching location:", error);
      });
    }

    // Initial call
    updateLocation();

    // Refresh location every 2.5 seconds
    setInterval(updateLocation, 2500);
  </script>

</body>
</html>
